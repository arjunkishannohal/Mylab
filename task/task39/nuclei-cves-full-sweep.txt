# ==============================================================================
# TASK 39: NUCLEI CVEs - FULL SWEEP (ALL SEVERITIES)
# ==============================================================================
# TOOL: Nuclei
# MODE: AGGRESSIVE - No limits (own target)
# TEMPLATES: cves/ (medium + low + info) + all remaining
# GOAL: ZERO MISS - Complete coverage
# ==============================================================================

## OBJECTIVE

Final comprehensive sweep for ALL remaining CVEs including medium, low,
and informational severity. This is the "never miss a vulnerability" task.

## PREREQUISITES

âœ… Nuclei installed: `nuclei -version`
âœ… Templates updated: `nuclei -update-templates`
âœ… Task 38 completed (critical/high CVEs done)
âœ… Tech knowledge accumulated from Tasks 35-38
âœ… Input: live URLs + tech stack

## AGGRESSIVE MODE SETTINGS

```bash
# AGGRESSIVE - Complete sweep, no limits
# Phase 1: Medium severity CVEs
nuclei -l targets.txt \
    -t cves/ -severity medium \
    -c 100 -rl 0 -timeout 10 -retries 3 \
    -bulk-size 100 -stats -json -nc \
    -o outputs/nuclei/cves_medium_results.json

# Phase 2: Low + Info severity CVEs
nuclei -l targets.txt \
    -t cves/ -severity low,info \
    -c 100 -rl 0 -timeout 10 -retries 3 \
    -bulk-size 100 -stats -json -nc \
    -o outputs/nuclei/cves_low_results.json

# Phase 3: ALL templates (catches any missed)
nuclei -l targets.txt \
    -t cves/ \
    -exclude-severity critical,high \
    -c 100 -rl 0 -timeout 10 -retries 3 \
    -bulk-size 100 -stats -json -nc \
    -o outputs/nuclei/cves_full_sweep.json
```

## COMPLETE CVE COVERAGE

```
After Task 38 (Critical+High): ~1500 templates âœ“
This Task (Medium+Low+Info): ~1500+ templates

Total CVE Coverage: ALL ~3000+ templates

By Severity Covered:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Severity   â”‚ Templates â”‚ Task      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Critical   â”‚ ~400      â”‚ Task 38 âœ“ â”‚
â”‚ High       â”‚ ~1100     â”‚ Task 38 âœ“ â”‚
â”‚ Medium     â”‚ ~800      â”‚ Task 39   â”‚
â”‚ Low        â”‚ ~400      â”‚ Task 39   â”‚
â”‚ Info       â”‚ ~300      â”‚ Task 39   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL      â”‚ ~3000+    â”‚ COMPLETE  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## BRAIN INTELLIGENCE - COVERAGE VERIFICATION

### Track What's Been Tested
```python
# Load all previous results to verify coverage
coverage = {
    'critical': load_results('cves_critical_results.json'),
    'high': load_results('cves_high_results.json'),
    'medium': [],
    'low': [],
    'info': []
}

# Track which templates were run
templates_run = set()
for result in all_results:
    templates_run.add(result['template-id'])

# Verify against all available templates
all_templates = get_nuclei_templates('cves/')
missing = all_templates - templates_run

if missing:
    print(f"[!] {len(missing)} templates not yet run - queuing...")
    run_remaining(missing)
```

### Never-Miss Verification
```python
def verify_complete_coverage():
    """Ensure ZERO templates were missed."""
    
    # Get all CVE templates
    result = subprocess.run(
        ['nuclei', '-tl', '-t', 'cves/'],
        capture_output=True, text=True
    )
    all_templates = set(result.stdout.strip().split('\n'))
    
    # Load all results from Tasks 38-39
    tested_templates = set()
    for results_file in glob('outputs/nuclei/cves_*.json'):
        with open(results_file) as f:
            for line in f:
                finding = json.loads(line)
                tested_templates.add(finding['template-id'])
    
    # Calculate coverage
    coverage_pct = len(tested_templates) / len(all_templates) * 100
    
    print(f"CVE Template Coverage: {coverage_pct:.1f}%")
    print(f"Templates Tested: {len(tested_templates)}/{len(all_templates)}")
    
    if coverage_pct < 99:
        print("[!] WARNING: Incomplete coverage detected")
        missing = all_templates - tested_templates
        print(f"Missing templates: {missing}")
        return False
    
    return True
```

## 9-MINUTE BATCH APPROACH

```
[Full Sweep Batching]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: Medium CVEs                               â”‚
â”‚ BATCH_SIZE = 500                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Batch 1-4: All URLs Ã— medium templates             â”‚
â”‚ Checkpoint after each batch                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 2: Low CVEs                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Batch 5-8: All URLs Ã— low templates                â”‚
â”‚ Checkpoint after each batch                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 3: Info CVEs                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Batch 9-12: All URLs Ã— info templates              â”‚
â”‚ Checkpoint after each batch                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 4: Coverage Verification                     â”‚
â”‚ Re-run any missed templates                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## EXECUTION

### Using Python Script
```bash
cd d:\wallet\Mylab

# Medium CVEs
python task/task35/nuclei_scanner.py \
    --scan-type cves-medium \
    --targets outputs/live_base_urls.txt \
    --output outputs \
    --temp temp/task39

# Low CVEs
python task/task35/nuclei_scanner.py \
    --scan-type cves-low \
    --targets outputs/live_base_urls.txt \
    --output outputs \
    --temp temp/task39

# Full sweep (all remaining)
python task/task35/nuclei_scanner.py \
    --scan-type cves-all \
    --targets outputs/live_base_urls.txt \
    --output outputs \
    --temp temp/task39
```

### Using Nuclei Directly
```bash
# Medium CVEs
nuclei -l outputs/live_base_urls.txt \
    -t cves/ -severity medium \
    -c 100 -rl 0 -timeout 10 -retries 3 \
    -json -stats -nc \
    -o outputs/nuclei/cves_medium.json

# Low + Info CVEs
nuclei -l outputs/live_base_urls.txt \
    -t cves/ -severity low,info \
    -c 100 -rl 0 -timeout 10 -retries 3 \
    -json -stats -nc \
    -o outputs/nuclei/cves_low_info.json
```

## OUTPUT FILES

| File | Description |
|------|-------------|
| `outputs/nuclei/cves_medium_results.json` | Medium severity findings |
| `outputs/nuclei/cves_low_results.json` | Low severity findings |
| `outputs/nuclei/cves_full_sweep.json` | Complete sweep results |
| `outputs/nuclei/cve_coverage_report.json` | Coverage verification |
| `outputs/vulnerabilities/NUCLEI-MED-*.md` | Medium vuln reports |
| `temp/task39/checkpoint.json` | Resume checkpoint |

## FINAL CONSOLIDATION

### Merge All Results
```python
def consolidate_all_findings():
    """Merge all Nuclei findings into master file."""
    
    all_findings = []
    
    # Load all result files
    result_files = [
        'outputs/nuclei/technologies_results.json',
        'outputs/nuclei/exposures_results.json',
        'outputs/nuclei/default_logins_results.json',
        'outputs/nuclei/cves_critical_results.json',
        'outputs/nuclei/cves_high_results.json',
        'outputs/nuclei/cves_medium_results.json',
        'outputs/nuclei/cves_low_results.json',
    ]
    
    for rf in result_files:
        if Path(rf).exists():
            with open(rf) as f:
                for line in f:
                    try:
                        all_findings.append(json.loads(line))
                    except:
                        pass
    
    # Deduplicate
    unique_findings = dedupe_by_template_and_host(all_findings)
    
    # Write master file
    with open('outputs/nuclei/ALL_FINDINGS_MASTER.json', 'w') as f:
        json.dump(unique_findings, f, indent=2)
    
    # Generate summary
    generate_final_summary(unique_findings)
```

### Summary Report
```python
def generate_final_summary(findings):
    """Generate final Nuclei scan summary."""
    
    # Count by severity
    by_severity = {}
    by_category = {}
    by_host = {}
    
    for f in findings:
        sev = f.get('info', {}).get('severity', 'unknown')
        cat = f.get('template-id', '').split('/')[0]
        host = f.get('host', 'unknown')
        
        by_severity[sev] = by_severity.get(sev, 0) + 1
        by_category[cat] = by_category.get(cat, 0) + 1
        by_host[host] = by_host.get(host, 0) + 1
    
    # Write summary
    with open('outputs/nuclei/SCAN_SUMMARY.md', 'w') as f:
        f.write("# Nuclei Scan Summary\n\n")
        f.write(f"Total Findings: {len(findings)}\n\n")
        f.write("## By Severity\n")
        for sev in ['critical', 'high', 'medium', 'low', 'info']:
            f.write(f"- {sev.upper()}: {by_severity.get(sev, 0)}\n")
        f.write("\n## Top Affected Hosts\n")
        for host, count in sorted(by_host.items(), key=lambda x: -x[1])[:10]:
            f.write(f"- {host}: {count} findings\n")
```

## CHAIN COMPLETION

```
Task 35 (Tech) â†’ Task 36 (Exposures) â†’ Task 37 (Logins) 
    â†’ Task 38 (CVE Crit/High) â†’ Task 39 (CVE Full) â†’ COMPLETE

Final outputs:
â”œâ”€â”€ outputs/nuclei/ALL_FINDINGS_MASTER.json
â”œâ”€â”€ outputs/nuclei/SCAN_SUMMARY.md
â”œâ”€â”€ outputs/nuclei/tech_stack.json (complete knowledge base)
â”œâ”€â”€ outputs/nuclei/cve_coverage_report.json
â””â”€â”€ outputs/vulnerabilities/*.md (all individual reports)
```

## SUCCESS CRITERIA

- [ ] ALL ~3000+ CVE templates tested
- [ ] Coverage verification shows 99%+ template coverage
- [ ] Medium findings â†’ P2 reports
- [ ] Low findings â†’ P3 reports
- [ ] Master findings file consolidates all Tasks 35-39
- [ ] Summary report generated
- [ ] ZERO vulnerabilities missed

## ZERO MISS GUARANTEE

```python
# Final verification script
def verify_zero_miss():
    """FINAL CHECK: Did we miss anything?"""
    
    checks = {
        'technologies_scanned': check_tech_coverage(),
        'exposures_scanned': check_exposure_coverage(),
        'default_logins_scanned': check_login_coverage(),
        'cves_critical_scanned': check_cve_coverage('critical'),
        'cves_high_scanned': check_cve_coverage('high'),
        'cves_medium_scanned': check_cve_coverage('medium'),
        'cves_low_scanned': check_cve_coverage('low'),
        'hosts_fully_scanned': check_host_coverage(),
    }
    
    for check, passed in checks.items():
        status = "âœ“" if passed else "âœ—"
        print(f"{status} {check}")
    
    if all(checks.values()):
        print("\nğŸ¯ ZERO MISS: Complete coverage achieved!")
        return True
    else:
        print("\nâš ï¸ Gaps detected - review and re-run missing scans")
        return False
```
